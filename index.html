<html>
<meta charset="utf-8">
<head>
  <title>Transform</title>
<link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>  

<div id="bigBox">
  <div id="graphBox"></div>
  <div id="dataBox">
    <div id="printBox"><div>TRANSFORMATIONS</div><br></div>
    <div id="inputBox">
      
        <form name="myform" action="#" onkeypress="handleClick(event)" autocomplete="off">
            ENTER TRANSFORMATION<br><br>
            <input type="text" id="myVal" placeholder="i.e 1,0,0,1" >
            <br><br>
            <div id="submit" onClick="handleClick(1)">Transform!</div>
        </form>

    </div>
  </div>
</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.14.2/math.js" type="text/javascript"></script>
<script src="/functions.js" type="text/javascript"></script>
<script src="https://d3js.org/d3.v3.min.js" type="text/javascript"></script>
<script>

var height = width = 700;
var margin = 4;
var unit = 50;
var ticks = math.floor(2*width/unit+1);

var latticeData = lattice(ticks)
// var latticeData = [[1,-2]]
// var latticeData = [[1,0],[0,1]]

var x = d3.scale.linear()
  .domain([0,1])
  .range([0,unit])

var y = d3.scale.linear()
  .domain([0,1])
  .range([0,-unit])

var color = d3.scale.linear()
  .domain([0, 4*ticks*ticks])
  .range([d3.rgb("#007AFF"), d3.rgb('#FFF500')]);

var svg = d3.select("#graphBox")
  .append("svg")
    .attr("width",width + margin*2)
    .attr("height",height + margin*2)
  .append("g")
    .attr("transform","translate(" + eval(width/2 + margin) + "," + eval(height/2 + margin) + ")")

var circle = svg.selectAll("circle")
    .data(latticeData)
  .enter().append("circle")
    .attr("cx",function(d){return x(d[0])})
    .attr("cy",function(d){return y(d[1])})
    .style("fill",function(d,i){return color(i)})
    .attr("r",4)


var xAxis = svg
  .append("line")
    .attr("class","x axis")
    .attr("x1",-width)
    .attr("y1",0)
    .attr("x2",width)
    .attr("y2",0)

var yAxis = svg
  .append("line")
    .attr("class","y axis")
    .attr("x1",0)
    .attr("y1",height)
    .attr("x2",0)
    .attr("y2",-height)


function update(data) {
  circle
      .data(data)
    .transition()
      .duration(6000)
      .attr("cx",function(d){return x(d[0])})
      .attr("cy",function(d){return y(d[1])})
      // .each("end",function(){print('test8')})
      // figure out how to stack these
}

var rotateL   =       [ [0,-1],
                        [1,0]];
var rotateR   =       [ [0,1],
                        [-1,0]];
var flipX     =       [ [1,0],
                        [0,-1]];
var flipY     =       [ [-1,0],
                        [0,1]];
var shearR    =       [ [1,1],
                        [0,1]];
var somethingCray =  [  [-2,1],
                        [-1,4]];


function transform(data,operation){
  if (typeof eval(operation) === "object"){
    operation = eval(operation);
  } else if (typeof eval(operation) === "number"){
    val = operation.split(",");
    var a = val[0];
    var b = val[1];
    var c = val[2];
    var d = val[3];
    operation = [[a,c],[b,d]];
  } 
  print(operation,true);
  return data.map(function(x) {
    return math.multiply(operation,x)
  })
}

function handleClick(e){
  if(e.keyCode === 13) {
    e.preventDefault();
  }
  if(e.keyCode === 13 || e === 1) {
    var inputTransform = document.getElementById("myVal").value;
    latticeData = transform(latticeData,inputTransform)
    update(latticeData);
    document.getElementById("myVal").value = "";
  }
  return false;
}


</script>
</body>
</html>